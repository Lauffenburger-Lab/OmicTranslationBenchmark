primates_nhp <- read_excel('data/NHP_trial_1319.xlsx',sheet=1)
primates_nhp <- primates_nhp %>% mutate(Vaccine=ifelse(Vaccine=='Sham',0,1))
primates_nhp <-  primates_nhp %>% mutate(ProtectBinary=ifelse(ProtectBinary==1,0,1))
primates_expr <- read_excel('data/NHP_trial_1319.xlsx',sheet=2)
primates_expr <- as.matrix(primates_expr)
View(primates_expr)
primates_nhp <- read_excel('data/NHP_trial_1319.xlsx',sheet=1)
primates_nhp <- primates_nhp %>% mutate(Vaccine=ifelse(Vaccine=='Sham',0,1))
primates_nhp <-  primates_nhp %>% mutate(ProtectBinary=ifelse(ProtectBinary==1,0,1))
primates_expr <- read_excel('data/NHP_trial_1319.xlsx',sheet=2)
primates_expr <- as.matrix(primates_expr)
### keep only Antigen measurements
primates_expr <- primates_expr[,30:292]
# 1 to 243 columns MFIs
primates_expr <- log10(primates_expr+1)
hist(primates_expr)
primates_nhp <- read_excel('data/NHP_trial_1319.xlsx',sheet=1)
primates_nhp <- primates_nhp %>% mutate(Vaccine=ifelse(Vaccine=='Sham',0,1))
primates_nhp <-  primates_nhp %>% mutate(ProtectBinary=ifelse(ProtectBinary==1,0,1))
primates_expr <- read_excel('data/NHP_trial_1319.xlsx',sheet=2)
primates_expr <- as.matrix(primates_expr)
### keep only Antigen measurements
primates_expr <- primates_expr[,30:292]
hist(primates_expr)
# 1 to 243 columns MFIs
primates_expr <- log10(primates_expr+1)
# normalize by substracting with median of SHAM
controls <- primates_expr[which(primates_nhp$Immunization_Ag=='Sham'),]
controlsMed <- apply(controls,2,median)
primates_expr <- primates_expr - controlsMed
hist(primates_expr,100)
# primates_expr <- primates_expr - colMeans(primates_expr)
primates_expr <- scale(primates_expr)
hist(primates_expr,100)
View(primates_expr)
is.nan(primates_expr)
primates_expr[is.nan(primates_expr)]
library(tidyverse)
library(ggplot2)
library(ggpubr)
# Analysis for classification of protection-------------
lrt_results <- data.table::fread('LRT_selected_latent_variables.csv')
View(lrt_results)
lrt_results <- lrt_results %>% filter(Fold!='')
View(lrt_results)
lrt_results <- lrt_results %>% gather('latent_var','value',-Fold)
View(lrt_results)
tt <- lrt_results %>% filter(value>0)
View(tt)
View(lrt_results)
# Analysis for classification of protection-------------
lrt_results <- data.table::fread('LRT_selected_latent_variables.csv') %>% select(-z32)
lrt_results <- lrt_results %>% filter(Fold!='')
colnames(lrt_results)[ncol(lrt_results)] <- 'lrt_counts'
lrt_results <- lrt_results %>% gather('latent_var','value',-Fold,-lrt_counts)
tt <- lrt_results %>% filter(value>0)
lrt_results <- lrt_results %>% filter(value>0) %>% select(-value) %>% mutate(lrt_importance='Important')
View(lrt_results)
tmp <- data.table::fread('importance_results/important_scores_to_classify_human_protection.csv')
View(tmp)
tmp <- tmp %>% select(-V1)
View(tmp)
mean_class_score <- rowMeans(tmp)
mean_class_score <- colMeans(tmp)
mean_class_score
hist(mean_class_score)
hist(mean_class_score,32)
mean_class_score[which(mean_class_score>0.2)]
View(lrt_results)
mean_class_score[which(mean_class_score<-0.02)]
mean_class_score[which(mean_class_score<(-0.02))]
mean_class_score[which(mean_class_score<0)]
which(mean_class_score<0)
which(mean_class_score<=0)
which(mean_class_score<=0.1)
mean_class_score[which(mean_class_score<=0.1)]
mean_class_score
mean_class_score <- colMeans(tmp)
mean_class_score[which(mean_class_score<(-0.02))]
# Load embeddings
emb <- data.table::fread('results_intermediate_encoders/embs/combined_10fold/latent_embeddings_global_9.csv')
View(emb)
ggplot(emb,aes(x=z11,y= z31,color=protected)) + geom_point()
df_class_score <- data.frame(mean_class_score)
View(df_class_score)
colnames(df_class_score) <- 'mean_score'
df_class_score <- df_class_score %>% rownames_to_column('latent_var')
View(df_class_score)
ggplot(df_class_score,aes(x=latent_var,y=mean_score)) + geom_bar()
ggplot(df_class_score,aes(x=latent_var,y=mean_score)) + geom_bar(stat = 'identity')
ggplot(df_class_score %>% arrange(abs(mean_score)),aes(x=latent_var,y=mean_score)) + geom_bar(stat = 'identity')
ggplot(df_class_score %>% arrange(-abs(mean_score)),aes(x=latent_var,y=mean_score)) + geom_bar(stat = 'identity')
df_class_score %>% arrange(-abs(mean_score))
ggplot(df_class_score,aes(x=reorder(latent_var,mean_score),y=mean_score))  +
geom_bar(stat='identity',fill='#0077b3') + xlab('Latent variable') +
ylab('Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
ggplot(df_class_score,aes(x=reorder(latent_var,-mean_score),y=mean_score))  +
geom_bar(stat='identity',fill='#0077b3') + xlab('Latent variable') +
ylab('Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
ggplot(emb,aes(x=z11,y= z13,color=protected)) + geom_point()
ggplot(emb,aes(x=z11,y= z13,color=as.factor(protected))) + geom_point()
ggplot(emb,aes(x=z11,color=as.factor(protected))) + geom_histogram()
ggplot(emb,aes(x=z11,fill=as.factor(protected))) + geom_histogram()
ggplot(emb %>% filter(species=='human'),aes(x=z11,y= z13,color=as.factor(protected))) + geom_point()
ggplot(emb  %>% filter(species=='human') ,aes(x=z11,fill=as.factor(protected))) + geom_histogram()
ggplot(emb  %>% filter(species=='human') ,aes(x=z31,fill=as.factor(protected))) + geom_histogram()
ggplot(emb %>% filter(species=='human'),aes(x=z31,y= z13,color=as.factor(protected))) + geom_point()
ggplot(emb,aes(x=z31,y= z13,color=as.factor(protected))) + geom_point()
ggplot(emb,aes(x=z31,y= z11,color=as.factor(protected))) + geom_point()
ggplot(emb ,aes(x=z31,fill=as.factor(protected))) + geom_histogram()
ggplot(emb ,aes(x=z31,fill=as.factor(protected))) + geom_point()
plot(emb$z11,color='blue')
plot(emb$z11,colour='blue')
plot(emb$z11,col='blue')
plot(emb$z11,fill='blue')
plot(emb$z11,col='blue')
plot(emb$z11,col=emb$protected)
ggplot(emb ,aes(x=seq(1,nrow(emb)),y=z31,fill=as.factor(protected))) + geom_point()
ggplot(emb %>% mutate(id=seq(1,nrow(emb)),aes(x=id,y=z31,fill=as.factor(protected))) + geom_point()
)
ggplot(emb %>% mutate(id=seq(1,nrow(emb))),aes(x=id,y=z31,fill=as.factor(protected))) + geom_point()
ggplot(emb,aes(x=z11,y= z13,color=as.factor(protected))) + geom_point()
ggplot(emb %>% mutate(id=seq(1,nrow(emb))),aes(x=id,y=z31,fill=as.factor(protected))) + geom_point()
ggplot(emb %>% mutate(id=seq(1,nrow(emb))),aes(x=id,y=z11,fill=as.factor(protected))) + geom_point()
ggplot(emb %>% mutate(id=seq(1,nrow(emb))),aes(x=id,y=z11,fill=protected)) + geom_point()
ggplot(emb %>% mutate(id=seq(1,nrow(emb))),aes(x=id,y=z11,fill=protected)) + geom_point(aes(fill=protected))
ggplot(emb,aes(x=z11,y= z13,color=as.factor(protected))) + geom_point()
i <- 1
tmp <- data.table::fread(paste0('importance_results/important_scores_to_classify_human_protection_',i-1,'.csv'))
tmp <- tmp %>% select(-V1)
tmp <- data.table::fread(paste0('importance_results/important_scores_to_classify_human_protection_',i-1,'.csv'))
tmp <- data.table::fread(paste0('importance_results/important_scores_to_classify_human_nonprotection_',i-1,'.csv'))
tmp <- tmp %>% select(-V1)
mean_class_score <- colMeans(tmp)
df_class_score <- data.frame(mean_class_score)
colnames(df_class_score) <- 'mean_score'
df_class_score <- df_class_score %>% rownames_to_column('latent_var')
ggplot(df_class_score,aes(x=reorder(latent_var,-mean_score),y=mean_score))  +
geom_bar(stat='identity',fill='#0077b3') + xlab('Latent variable') +
ylab('Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
# Load embeddings
emb <- data.table::fread('results_intermediate_encoders/embs/combined_10fold/latent_embeddings_global_0.csv')
# Load embeddings
emb <- data.table::fread('results_intermediate_encoders/embs/combined_10fold/latent_embeddings_global_1.csv')
ggplot(emb,aes(x=z0,y= z20,color=as.factor(protected))) + geom_point()
i <- 0
i <- 10
tmp <- data.table::fread(paste0('importance_results/important_scores_to_classify_human_nonprotection_',i-1,'.csv'))
tmp <- tmp %>% select(-V1)
mean_class_score <- colMeans(tmp)
df_class_score <- data.frame(mean_class_score)
colnames(df_class_score) <- 'mean_score'
df_class_score <- df_class_score %>% rownames_to_column('latent_var')
ggplot(df_class_score,aes(x=reorder(latent_var,-mean_score),y=mean_score))  +
geom_bar(stat='identity',fill='#0077b3') + xlab('Latent variable') +
ylab('Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
# Load embeddings
emb <- data.table::fread('results_intermediate_encoders/embs/combined_10fold/latent_embeddings_global_10.csv')
ggplot(emb,aes(x=z0,y= z11,color=as.factor(protected))) + geom_point()
emb <- emb %>% mutate(protected=ifelse(protected==1,'protected','non-protected'))
# Load embeddings
emb <- data.table::fread('results_intermediate_encoders/embs/combined_10fold/latent_embeddings_global_10.csv')
emb <- emb %>% mutate(protected=ifelse(protected==1,'protected','non-protected'))
ggplot(emb,aes(x=z0,y= z11,color=protected)) + geom_point()
ggplot(emb,aes(x=z11,y= z0,color=protected)) + geom_point()
ggplot(emb,aes(x=z11,y= z13,color=protected)) + geom_point()
ggplot(emb,aes(x=z11,y= z31,color=protected)) + geom_point()
tmp <- data.table::fread(paste0('importance_results/important_scores_to_classify_human_nonprotection_',i-1,'.csv'))
tmp <- tmp %>% select(-V1)
mean_class_score <- colMeans(tmp)
df_class_score <- data.frame(-mean_class_score)
colnames(df_class_score) <- 'mean_score'
df_class_score <- df_class_score %>% rownames_to_column('latent_var')
ggplot(df_class_score,aes(x=reorder(latent_var,-mean_score),y=mean_score))  +
geom_bar(stat='identity',fill='#0077b3') + xlab('Latent variable') +
ylab('Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
# Load embeddings
emb <- data.table::fread('results_intermediate_encoders/embs/combined_10fold/latent_embeddings_global_10.csv')
emb <- emb %>% mutate(protected=ifelse(protected==1,'protected','non-protected'))
ggplot(emb,aes(x=z11,y= z31,color=protected)) + geom_point()
ggplot(emb,aes(x=z11,fill=protected)) + geom_histogram(stat='identity')
ggplot(emb,aes(x=z11,fill=protected)) + geom_histogram()
ggplot(emb,aes(x=z11,fill=protected)) + geom_density()
ggplot(emb,aes(x=z0,fill=protected)) + geom_density()
ggplot(emb,aes(x=z7,fill=protected)) + geom_density()
ggplot(emb,aes(x=z13,fill=protected)) + geom_density()
ggplot(emb,aes(x=z11,y= z7,color=protected)) + geom_point()
ggplot(emb,aes(x=z11,fill=protected)) + geom_density()
i <- 0
i <- 10
tmp <- data.table::fread(paste0('importance_results/important_scores_to_classify_human_protection_',i-1,'.csv'))
tmp <- tmp %>% select(-V1)
mean_class_score <- colMeans(tmp)
df_class_score <- data.frame(mean_class_score)
colnames(df_class_score) <- 'mean_score'
df_class_score <- df_class_score %>% rownames_to_column('latent_var')
ggplot(df_class_score,aes(x=reorder(latent_var,-mean_score),y=mean_score))  +
geom_bar(stat='identity',fill='#0077b3') + xlab('Latent variable') +
ylab('Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
View(df_class_score)
View(lrt_results)
df_class_score <- df_class_score %>% mutate(Fold = paste0('global_',i))
grad_results <- rbind(grad_results,df_class_score)
# Load classification results
grad_results <- data.frame()
grad_results <- rbind(grad_results,df_class_score)
# Load LRT results
lrt_results <- data.table::fread('LRT_selected_latent_variables.csv') %>% select(-z32)
lrt_results <- lrt_results %>% filter(Fold!='')
colnames(lrt_results)[ncol(lrt_results)] <- 'lrt_counts'
lrt_results <- lrt_results %>% gather('latent_var','value',-Fold,-lrt_counts)
lrt_results <- lrt_results %>% filter(value>0) %>% select(-value) %>% mutate(lrt_importance='Important')
# Load classification results
grad_results <- data.frame()
for (i in 1:10){
tmp <- data.table::fread(paste0('importance_results/important_scores_to_classify_human_protection_',i-1,'.csv'))
tmp <- tmp %>% select(-V1)
mean_class_score <- colMeans(tmp)
df_class_score <- data.frame(mean_class_score)
colnames(df_class_score) <- 'mean_score'
df_class_score <- df_class_score %>% rownames_to_column('latent_var')
df_class_score <- df_class_score %>% mutate(Fold = paste0('global_',i))
grad_results <- rbind(grad_results,df_class_score)
}
View(grad_results)
library(ggridges)
ggplot(grad_results,aes(x=reorder(latent_var,latent_var),y=mean_score))  +
geom_bar(stat='identity',fill='#0077b3') + xlab('Latent variable') +
ylab('Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
str_split_fixed(grad_results$latent_var)
str_split_fixed(grad_results$latent_var,'z')
str_split_fixed(grad_results$latent_var,'z',n=2)
str_split_fixed(grad_results$latent_var,'z',n=2)[,2]
as.numeric(str_split_fixed(grad_results$latent_var,'z',n=2)[,2])
ggplot(grad_results,aes(x=reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),y=mean_score))  +
geom_bar(stat='identity',fill='#0077b3') + xlab('Latent variable') +
ylab('Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
ggplot(grad_results,
aes(x=reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score,
fill=Fold))  +
geom_bar(stat='identity') + xlab('Latent variable') +
ylab('Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
ggplot(grad_results,
aes(x=reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score,
fill=Fold))  +
geom_col()
grad_results$latent_var <- factor(grad_results$latent_var,levels = paste0('z',seq(0,31)))
View(grad_results)
ggplot(grad_results,
aes(x=latent_var,#reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score,
fill=Fold))  +
geom_col()
ggplot(grad_results,
aes(x=latent_var,#reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score,
fill=Fold))  +
geom_col(position = position_dodge())
ggplot(grad_results %>% group_by(Fold) %>% mutate(mean_score=100*mean_score/max(abs(mean_score))),
aes(x=latent_var,#reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score,
fill=Fold))  +
geom_col(position = position_dodge()) + xlab('Latent variable') +
ylab('% Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
# ggplot(grad_results %>% group_by(Fold) %>% mutate(mean_score=100*mean_score/max(abs(mean_score))),
#        aes(x=latent_var,#reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
#            y=mean_score,
#            fill=Fold))  +
#   geom_col(position = position_dodge()) + xlab('Latent variable') +
#   ylab('% Importance score for classifying protection')+
#   ggtitle('Important latent variables for protection') +
#   theme_minimal(base_family = "Arial",base_size = 20)+
#   theme(plot.title = element_text(size=20,hjust = 0.5))
ggplot(grad_results,
aes(x=reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score,
fill=Fold))  +
geom_bar(stat='identity') + xlab('Latent variable') +
ylab('Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
# ggplot(grad_results %>% group_by(Fold) %>% mutate(mean_score=100*mean_score/max(abs(mean_score))),
#        aes(x=latent_var,#reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
#            y=mean_score,
#            fill=Fold))  +
#   geom_col(position = position_dodge()) + xlab('Latent variable') +
#   ylab('% Importance score for classifying protection')+
#   ggtitle('Important latent variables for protection') +
#   theme_minimal(base_family = "Arial",base_size = 20)+
#   theme(plot.title = element_text(size=20,hjust = 0.5))
ggplot(grad_results %>% group_by(Fold) %>% mutate(mean_score=100*mean_score/max(abs(mean_score))) %>% ungroup(),
aes(x=reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score,
fill=Fold))  +
geom_bar(stat='identity') + xlab('Latent variable') +
ylab('Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
# ggplot(grad_results %>% group_by(Fold) %>% mutate(mean_score=100*mean_score/max(abs(mean_score))),
#        aes(x=latent_var,#reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
#            y=mean_score,
#            fill=Fold))  +
#   geom_col(position = position_dodge()) + xlab('Latent variable') +
#   ylab('% Importance score for classifying protection')+
#   ggtitle('Important latent variables for protection') +
#   theme_minimal(base_family = "Arial",base_size = 20)+
#   theme(plot.title = element_text(size=20,hjust = 0.5))
ggplot(grad_results %>% group_by(Fold) %>% mutate(mean_score=100*mean_score/max(abs(mean_score))) %>% ungroup(),
aes(x=reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score,
fill=Fold))  +
geom_bar(stat='identity',position = position_dodge()) + xlab('Latent variable') +
ylab('Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
ggplot(grad_results %>% group_by(Fold) %>% mutate(mean_score=100*mean_score/max(abs(mean_score))) %>% ungroup(),
aes(x=reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score))  +
geom_bar(stat='identity') + xlab('Latent variable') + #position = position_dodge()
ylab('Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
ggplot(grad_results,
aes(x=reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score))  +
geom_bar(stat='identity') + xlab('Latent variable') + #position = position_dodge()
ylab('Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
ggplot(grad_results,
aes(x=reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score))  +
geom_bar(stat='identity') + xlab('Latent variable') + #position = position_dodge()
facet_wrap(~Fold)+
ylab('Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
ggplot(grad_results %>% group_by(Fold) %>% mutate(mean_score=100*mean_score/max(abs(mean_score))) %>% ungroup(),
aes(x=reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score))  +
geom_bar(stat='identity') + xlab('Latent variable') + #position = position_dodge()
facet_wrap(~Fold)+
ylab('Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
ggplot(grad_results %>% group_by(Fold) %>% mutate(mean_score=100*mean_score/max(abs(mean_score))) %>% ungroup(),
aes(x=latent_var, #reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score))  +
geom_bar(stat='identity') + xlab('Latent variable') + #position = position_dodge()
facet_wrap(~Fold)+
ylab('% Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
grad_results <- grad_results %>% mutate(Fold = str_split(Fold,'_')) %>% unnest(Fold)
View(grad_results)
# Load classification results
grad_results <- data.frame()
for (i in 1:10){
tmp <- data.table::fread(paste0('importance_results/important_scores_to_classify_human_protection_',i-1,'.csv'))
tmp <- tmp %>% select(-V1)
mean_class_score <- colMeans(tmp)
df_class_score <- data.frame(mean_class_score)
colnames(df_class_score) <- 'mean_score'
df_class_score <- df_class_score %>% rownames_to_column('latent_var')
df_class_score <- df_class_score %>% mutate(Fold = paste0('global_',i))
grad_results <- rbind(grad_results,df_class_score)
}
grad_results$latent_var <- factor(grad_results$latent_var,levels = paste0('z',seq(0,31)))
grad_results <- grad_results %>% mutate(Fold = str_split(Fold,'_')) %>% unnest(Fold) %>%
filter(Fold!='global') %>% mutate(Fold = paste0('fold ',Fold-1))
grad_results <- grad_results %>% mutate(Fold = str_split(Fold,'_')) %>% unnest(Fold) %>%
filter(Fold!='global') %>% mutate(Fold = paste0('fold ',as.numeric(Fold)-1))
grad_results$Fold <- factor(grad_results$Fold,levels = paste0('fold ',seq(0,9)))
ggplot(grad_results %>% group_by(Fold) %>% mutate(mean_score=100*mean_score/max(abs(mean_score))) %>% ungroup(),
aes(x=latent_var, #reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score))  +
geom_bar(stat='identity') + xlab('Latent variable') + #position = position_dodge()
facet_wrap(~Fold)+
ylab('% Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
ggplot(grad_results %>% group_by(Fold) %>% mutate(mean_score=100*mean_score/max(abs(mean_score))) %>% ungroup(),
aes(x=latent_var, #reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score))  +
geom_bar(stat='identity') + xlab('Latent variable') + #position = position_dodge()
facet_wrap(~Fold,ncol = 3)+
ylab('% Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 20)+
theme(plot.title = element_text(size=20,hjust = 0.5))
ggplot(grad_results %>% group_by(Fold) %>% mutate(mean_score=100*mean_score/max(abs(mean_score))) %>% ungroup(),
aes(x=latent_var, #reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score))  +
geom_bar(stat='identity',fill='#0077b3') + xlab('Latent variable') + #position = position_dodge()
facet_wrap(~Fold,ncol = 3)+
ylab('% Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 16)+
theme(plot.title = element_text(size=20,hjust = 0.5))
ggplot(grad_results %>% group_by(Fold) %>% mutate(mean_score=100*mean_score/max(abs(mean_score))) %>% ungroup(),
aes(x=latent_var, #reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score))  +
geom_bar(stat='identity',fill='#0077b3') + xlab('Latent variable') + #position = position_dodge()
facet_wrap(~Fold,ncol = 3)+
ylab('% Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 14)+
theme(plot.title = element_text(size=20,hjust = 0.5))
# Load LRT results
lrt_results <- data.table::fread('LRT_selected_latent_variables.csv') %>% select(-z32)
lrt_results <- lrt_results %>% filter(Fold!='')
colnames(lrt_results)[ncol(lrt_results)] <- 'lrt_counts'
lrt_results <- lrt_results %>% gather('latent_var','value',-Fold,-lrt_counts)
lrt_results <- lrt_results %>% filter(value>0) %>% select(-value) %>% mutate(lrt_importance='Important')
lrt_results <- lrt_results%>% mutate(Fold = str_split(Fold,'_')) %>% unnest(Fold) %>%
filter(Fold!='global') %>% mutate(Fold = paste0('fold ',as.numeric(Fold)-1))
View(lrt_results)
# Load classification results
grad_results <- data.frame()
for (i in 1:10){
tmp <- data.table::fread(paste0('importance_results/important_scores_to_classify_human_protection_',i-1,'.csv'))
tmp <- tmp %>% select(-V1)
mean_class_score <- colMeans(tmp)
df_class_score <- data.frame(mean_class_score)
colnames(df_class_score) <- 'mean_score'
df_class_score <- df_class_score %>% rownames_to_column('latent_var')
df_class_score <- df_class_score %>% mutate(Fold = paste0('global_',i))
grad_results <- rbind(grad_results,df_class_score)
}
grad_results$latent_var <- factor(grad_results$latent_var,levels = paste0('z',seq(0,31)))
grad_results <- grad_results %>% mutate(Fold = str_split(Fold,'_')) %>% unnest(Fold) %>%
filter(Fold!='global') %>% mutate(Fold = paste0('fold ',as.numeric(Fold)-1))
grad_results$Fold <- factor(grad_results$Fold,levels = paste0('fold ',seq(0,9)))
grad_results %>% group_by(Fold) %>% mutate(mean_score=100*mean_score/max(abs(mean_score))) %>% ungroup()
grad_results <- left_join(lrt_results,grad_results)
# Load classification results
grad_results <- data.frame()
for (i in 1:10){
tmp <- data.table::fread(paste0('importance_results/important_scores_to_classify_human_protection_',i-1,'.csv'))
tmp <- tmp %>% select(-V1)
mean_class_score <- colMeans(tmp)
df_class_score <- data.frame(mean_class_score)
colnames(df_class_score) <- 'mean_score'
df_class_score <- df_class_score %>% rownames_to_column('latent_var')
df_class_score <- df_class_score %>% mutate(Fold = paste0('global_',i))
grad_results <- rbind(grad_results,df_class_score)
}
grad_results$latent_var <- factor(grad_results$latent_var,levels = paste0('z',seq(0,31)))
grad_results <- grad_results %>% mutate(Fold = str_split(Fold,'_')) %>% unnest(Fold) %>%
filter(Fold!='global') %>% mutate(Fold = paste0('fold ',as.numeric(Fold)-1))
grad_results$Fold <- factor(grad_results$Fold,levels = paste0('fold ',seq(0,9)))
grad_results <- grad_results %>% group_by(Fold) %>% mutate(mean_score=100*mean_score/max(abs(mean_score))) %>% ungroup()
grad_results <- left_join(lrt_results,grad_results)
ggplot(grad_results,
aes(x=latent_var, #reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score))  +
geom_bar(stat='identity',fill='#0077b3') + xlab('Latent variable') + #position = position_dodge()
facet_wrap(~Fold,ncol = 3)+
ylab('% Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 14)+
theme(plot.title = element_text(size=20,hjust = 0.5))
ggplot(grad_results,
aes(x=reorder(latent_var,as.numeric(str_split_fixed(latent_var,'z',n=2)[,2])),
y=mean_score))  +
geom_bar(stat='identity',fill='#0077b3') + xlab('Latent variable') + #position = position_dodge()
facet_wrap(~Fold,ncol = 3)+
ylab('% Importance score for classifying protection')+
ggtitle('Important latent variables for protection') +
theme_minimal(base_family = "Arial",base_size = 14)+
theme(plot.title = element_text(size=20,hjust = 0.5))
