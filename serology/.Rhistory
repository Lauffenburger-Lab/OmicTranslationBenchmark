p1 <- ggplot(x, aes(x = value, y = as.factor(latent_variable))) +
geom_density_ridges(stat = "binline",bins = 100,alpha = 0.8,
fill = '#125b80',color='black') +
ggtitle('Distribution of latent variables in global space')+
xlab('value') + ylab('latent variable')+ theme(base_family = "Arial") +
theme_pubr(base_family = "Arial",base_size = 14) +
theme(plot.title = element_text(hjust = 0.5))
print(p1)
#Load embeddings
z_human <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold_1000ep/z_human_train_',i-1,'.csv')) %>% column_to_rownames('V1')
latent_dim <- ncol(z_human)
# z_human <- z_human %>% mutate(protected = human_hiv$infect)
# z_human <- z_human %>% mutate(vaccinated = human_hiv$trt)
z_human <- z_human %>% mutate(species = 'human')
z_human_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold_1000ep/z_human_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_human_base <- z_human_base %>% mutate(protected = human_hiv$infect)
# z_human_base <- z_human_base %>% mutate(vaccinated = human_hiv$trt)
z_human_base <- z_human_base %>% mutate(species = 'human')
z_primates <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold_1000ep/z_primates_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates <- z_primates %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates <- z_primates %>% mutate(vaccinated = z_humanprimates_nhp$Vaccine)
z_primates <- z_primates %>% mutate(species = 'primates')
z_primates_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold_1000ep/z_primates_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates_base <- z_primates_base %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates_base <- z_primates_base %>% mutate(vaccinated = primates_nhp$Vaccine)
z_primates_base <- z_primates_base %>% mutate(species = 'primates')
z_latent <- rbind(z_human,z_primates)
z_latent_base <- rbind(z_human_base,z_primates_base)
### Dimensionality reduction and visualization
pca <- prcomp(z_latent_base[,1:latent_dim],center = T)
#fviz_eig(pca, addlabels = TRUE,ncp = 15)
df_pca<- pca$x[,1:3]
df_pca <- as.data.frame(df_pca)
colnames(df_pca) <- c('PC1','PC2','PC3')
df_pca <- df_pca %>% mutate(protected = z_latent_base$protected)
df_pca$protected <- factor(df_pca$protected)
df_pca <- df_pca %>% mutate(vaccinated = z_latent_base$vaccinated)
df_pca$vaccinated <- factor(df_pca$vaccinated)
df_pca <- df_pca %>% mutate(species = z_latent_base$species)
df_pca$species <- factor(df_pca$species)
pca_plot <- ggplot(df_pca,aes(PC1,PC2)) +geom_point(aes(col=protected,shape=species,alpha=vaccinated))+
scale_color_manual(values = c('#4878CF','#D65F5F'))+
scale_alpha_manual(values = c(0.5,1))+
ggtitle('') +
xlab(paste0('PC1'))+ ylab(paste0('PC2'))+theme_minimal()+
theme(text = element_text(size=16),plot.title = element_text(hjust = 0.5),
legend.text=element_text(size=16))
print(pca_plot)
p1 <- ggplot(x, aes(x = value, y = as.factor(latent_variable))) +
geom_density_ridges(stat = "binline",bins = 100,alpha = 0.8,
fill = '#125b80',color='black') +
ggtitle('Distribution of latent variables in global space')+
xlab('value') + ylab('latent variable')+ theme(base_family = "Arial") +
theme_pubr(base_family = "Arial",base_size = 14) +
theme(plot.title = element_text(hjust = 0.5))
print(p1)
### Load embeddings and data and combine them
#Load data
human_expr <- data.table::fread('data/human_exprs.csv') %>% column_to_rownames('V1')
human_hiv <- data.table::fread('data/human_metadata.csv') %>% column_to_rownames('V1')
primates_expr <- data.table::fread('data/primates_exprs.csv') %>% column_to_rownames('V1')
primates_nhp <- data.table::fread('data/primates_metadata.csv') %>% column_to_rownames('V1')
plotList <- NULL
for (i in 1:10){
#Load embeddings
z_human <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_train_',i-1,'.csv')) %>% column_to_rownames('V1')
latent_dim <- ncol(z_human)
# z_human <- z_human %>% mutate(protected = human_hiv$infect)
# z_human <- z_human %>% mutate(vaccinated = human_hiv$trt)
z_human <- z_human %>% mutate(species = 'human')
z_human_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_human_base <- z_human_base %>% mutate(protected = human_hiv$infect)
# z_human_base <- z_human_base %>% mutate(vaccinated = human_hiv$trt)
z_human_base <- z_human_base %>% mutate(species = 'human')
z_primates <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates <- z_primates %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates <- z_primates %>% mutate(vaccinated = z_humanprimates_nhp$Vaccine)
z_primates <- z_primates %>% mutate(species = 'primates')
z_primates_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates_base <- z_primates_base %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates_base <- z_primates_base %>% mutate(vaccinated = primates_nhp$Vaccine)
z_primates_base <- z_primates_base %>% mutate(species = 'primates')
z_latent <- rbind(z_human,z_primates)
z_latent_base <- rbind(z_human_base,z_primates_base)
### Dimensionality reduction and visualization
pca <- prcomp(z_latent_base[,1:latent_dim],center = T)
#fviz_eig(pca, addlabels = TRUE,ncp = 15)
df_pca<- pca$x[,1:3]
df_pca <- as.data.frame(df_pca)
colnames(df_pca) <- c('PC1','PC2','PC3')
df_pca <- df_pca %>% mutate(protected = z_latent_base$protected)
df_pca$protected <- factor(df_pca$protected)
df_pca <- df_pca %>% mutate(vaccinated = z_latent_base$vaccinated)
df_pca$vaccinated <- factor(df_pca$vaccinated)
df_pca <- df_pca %>% mutate(species = z_latent_base$species)
df_pca$species <- factor(df_pca$species)
pca_plot <- ggplot(df_pca,aes(PC1,PC2)) +geom_point(aes(col=protected,shape=species,alpha=vaccinated))+
scale_color_manual(values = c('#4878CF','#D65F5F'))+
scale_alpha_manual(values = c(0.5,1))+
ggtitle('') +
xlab(paste0('PC1'))+ ylab(paste0('PC2'))+theme_minimal()+
theme(text = element_text(size=16),plot.title = element_text(hjust = 0.5),
legend.text=element_text(size=16))
print(pca_plot)
plotList[[i]] <- pca_plot
# z_latent_base_gathered <- z_latent_base %>% gather('latent_variable','value',-species,-vaccinated,-protected)
# p_base <- ggplot(z_latent_base_gathered, aes(x = value, y = as.factor(latent_variable))) +
#   geom_density_ridges(stat = "binline",bins = 100,alpha = 0.8,
#                       fill = '#125b80',color='black') +
#   ggtitle('Distribution of latent variables in global space')+
#   xlab('value') + ylab('latent variable')+ theme(base_family = "Arial") +
#   theme_pubr(base_family = "Arial",base_size = 14) +
#   theme(plot.title = element_text(hjust = 0.5))
# print(p_base)
}
# Visualize all subplots
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
png(file="results_intermediate_encoders/pca_2d_global_train_2000ep.png",width=16,height=16,units = "in",res=600)
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
dev.off()
x <- c(1,2,3)
y <- c(4,5,6)
x - 1
vec_pairwise_sub <- function(c,u){
return(u-c)
}
x <- as.matrix(x)
x
tt <- apply(x,1,vec_pairwise_sub,y)
View(tt)
x
y
random(3)
rand(3)
randn(3)
tt
tt <- tt[1:2,]
tt
colSums(tt)
y <- c(5,6,6,7,8)
tt <- apply(x,1,vec_pairwise_sub,y)
x
y
tt
View(z_latent)
gc()
### Load embeddings and data and combine them
#Load data
human_expr <- data.table::fread('data/human_exprs.csv') %>% column_to_rownames('V1')
human_hiv <- data.table::fread('data/human_metadata.csv') %>% column_to_rownames('V1')
primates_expr <- data.table::fread('data/primates_exprs.csv') %>% column_to_rownames('V1')
primates_nhp <- data.table::fread('data/primates_metadata.csv') %>% column_to_rownames('V1')
plotList <- NULL
for (i in 1:10){
#Load embeddings
z_human <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_train_',i-1,'.csv')) %>% column_to_rownames('V1')
latent_dim <- ncol(z_human)
# z_human <- z_human %>% mutate(protected = human_hiv$infect)
# z_human <- z_human %>% mutate(vaccinated = human_hiv$trt)
z_human <- z_human %>% mutate(species = 'human')
z_human_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_human_base <- z_human_base %>% mutate(protected = human_hiv$infect)
# z_human_base <- z_human_base %>% mutate(vaccinated = human_hiv$trt)
z_human_base <- z_human_base %>% mutate(species = 'human')
z_primates <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates <- z_primates %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates <- z_primates %>% mutate(vaccinated = z_humanprimates_nhp$Vaccine)
z_primates <- z_primates %>% mutate(species = 'primates')
z_primates_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates_base <- z_primates_base %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates_base <- z_primates_base %>% mutate(vaccinated = primates_nhp$Vaccine)
z_primates_base <- z_primates_base %>% mutate(species = 'primates')
z_latent <- rbind(z_human,z_primates)
z_latent_base <- rbind(z_human_base,z_primates_base)
data.table::fwrite(z_latent_base,paste0('results_intermediate_encoders/embs/combined_10fold/latent_embeddings_global_',i,'.csv'))
data.table::fwrite(z_latent,paste0('results_intermediate_encoders/embs/combined_10fold/latent_embeddings_',i,'.csv'))
### Dimensionality reduction and visualization
pca <- prcomp(z_latent_base[,1:latent_dim],center = T)
#fviz_eig(pca, addlabels = TRUE,ncp = 15)
df_pca<- pca$x[,1:3]
df_pca <- as.data.frame(df_pca)
colnames(df_pca) <- c('PC1','PC2','PC3')
df_pca <- df_pca %>% mutate(protected = z_latent_base$protected)
df_pca$protected <- factor(df_pca$protected)
df_pca <- df_pca %>% mutate(vaccinated = z_latent_base$vaccinated)
df_pca$vaccinated <- factor(df_pca$vaccinated)
df_pca <- df_pca %>% mutate(species = z_latent_base$species)
df_pca$species <- factor(df_pca$species)
pca_plot <- ggplot(df_pca,aes(PC1,PC2)) +geom_point(aes(col=protected,shape=species,alpha=vaccinated))+
scale_color_manual(values = c('#4878CF','#D65F5F'))+
scale_alpha_manual(values = c(0.5,1))+
ggtitle('') +
xlab(paste0('PC1'))+ ylab(paste0('PC2'))+theme_minimal()+
theme(text = element_text(size=16),plot.title = element_text(hjust = 0.5),
legend.text=element_text(size=16))
print(pca_plot)
plotList[[i]] <- pca_plot
# z_latent_base_gathered <- z_latent_base %>% gather('latent_variable','value',-species,-vaccinated,-protected)
# p_base <- ggplot(z_latent_base_gathered, aes(x = value, y = as.factor(latent_variable))) +
#   geom_density_ridges(stat = "binline",bins = 100,alpha = 0.8,
#                       fill = '#125b80',color='black') +
#   ggtitle('Distribution of latent variables in global space')+
#   xlab('value') + ylab('latent variable')+ theme(base_family = "Arial") +
#   theme_pubr(base_family = "Arial",base_size = 14) +
#   theme(plot.title = element_text(hjust = 0.5))
# print(p_base)
}
# Visualize all subplots
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
png(file="results_intermediate_encoders/pca_2d_global_train_2000ep.png",width=16,height=16,units = "in",res=600)
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
dev.off()
### Reapeat for the average of all models-------------
#Load embeddings
z_human <- data.table::fread('results_intermediate_encoders/embs/z_human.csv') %>% column_to_rownames('V1')
latent_dim <- ncol(z_human)
z_human <- z_human %>% mutate(protected = human_hiv$infect)
z_human <- z_human %>% mutate(vaccinated = human_hiv$trt)
z_human <- z_human %>% mutate(species = 'human')
z_human_base <- data.table::fread('results_intermediate_encoders/embs/z_human_base.csv') %>% column_to_rownames('V1')
z_human_base <- z_human_base %>% mutate(protected = human_hiv$infect)
z_human_base <- z_human_base %>% mutate(vaccinated = human_hiv$trt)
z_human_base <- z_human_base %>% mutate(species = 'human')
z_primates <- data.table::fread('results_intermediate_encoders/embs/z_primate.csv') %>% column_to_rownames('V1')
z_primates <- z_primates %>% mutate(protected = primates_nhp$ProtectBinary)
### Reapeat for the average of all models-------------
#Load embeddings
z_human <- data.table::fread('results_intermediate_encoders/embs/z_human.csv') %>% column_to_rownames('V1')
latent_dim <- ncol(z_human)
z_human <- z_human %>% mutate(protected = human_hiv$infect)
z_human <- z_human %>% mutate(vaccinated = human_hiv$trt)
z_human <- z_human %>% mutate(species = 'human')
z_human_base <- data.table::fread('results_intermediate_encoders/embs/z_human_base.csv') %>% column_to_rownames('V1')
z_human_base <- z_human_base %>% mutate(protected = human_hiv$infect)
z_human_base <- z_human_base %>% mutate(vaccinated = human_hiv$trt)
z_human_base <- z_human_base %>% mutate(species = 'human')
z_primates <- data.table::fread('results_intermediate_encoders/embs/z_primate.csv') %>% column_to_rownames('V1')
z_primates <- data.table::fread('results_intermediate_encoders/embs/z_primates.csv') %>% column_to_rownames('V1')
z_primates <- z_primates %>% mutate(protected = primates_nhp$ProtectBinary)
z_primates <- z_primates %>% mutate(vaccinated = z_humanprimates_nhp$Vaccine)
z_primates <- z_primates %>% mutate(species = 'primates')
z_primates <- data.table::fread('results_intermediate_encoders/embs/z_primates.csv') %>% column_to_rownames('V1')
### Reapeat for the average of all models-------------
#Load embeddings
z_human <- data.table::fread('results_intermediate_encoders/embs/z_human.csv') %>% column_to_rownames('V1')
latent_dim <- ncol(z_human)
z_human <- z_human %>% mutate(protected = human_hiv$infect)
z_human <- z_human %>% mutate(vaccinated = human_hiv$trt)
z_human <- z_human %>% mutate(species = 'human')
z_human_base <- data.table::fread('results_intermediate_encoders/embs/z_human_base.csv') %>% column_to_rownames('V1')
z_human_base <- z_human_base %>% mutate(protected = human_hiv$infect)
z_human_base <- z_human_base %>% mutate(vaccinated = human_hiv$trt)
z_human_base <- z_human_base %>% mutate(species = 'human')
z_primates <- data.table::fread('results_intermediate_encoders/embs/z_primates.csv') %>% column_to_rownames('V1')
z_primates <- z_primates %>% mutate(protected = primates_nhp$ProtectBinary)
z_primates <- z_primates %>% mutate(vaccinated = primates_nhp$Vaccine)
z_primates <- z_primates %>% mutate(species = 'primates')
z_primates_base <- data.table::fread('results_intermediate_encoders/embs/z_primates_base.csv') %>% column_to_rownames('V1')
z_primates_base <- z_primates_base %>% mutate(protected = primates_nhp$ProtectBinary)
z_primates_base <- z_primates_base %>% mutate(vaccinated = primates_nhp$Vaccine)
z_primates_base <- z_primates_base %>% mutate(species = 'primates')
z_latent <- rbind(z_human,z_primates)
z_latent_base <- rbind(z_human_base,z_primates_base)
data.table::fwrite(z_latent_base,paste0('results_intermediate_encoders/embs/latent_embeddings_global_',i,'.csv'))
data.table::fwrite(z_latent,paste0('results_intermediate_encoders/embs/latent_embeddings_',i,'.csv'))
### Dimensionality reduction and visualization
pca <- prcomp(z_latent_base[,1:latent_dim],center = T)
fviz_eig(pca, addlabels = TRUE,ncp = 15)
df_pca<- pca$x[,1:3]
df_pca <- as.data.frame(df_pca)
colnames(df_pca) <- c('PC1','PC2','PC3')
df_pca <- df_pca %>% mutate(protected = z_latent_base$protected)
df_pca$protected <- factor(df_pca$protected)
df_pca <- df_pca %>% mutate(vaccinated = z_latent_base$vaccinated)
df_pca$vaccinated <- factor(df_pca$vaccinated)
df_pca <- df_pca %>% mutate(species = z_latent_base$species)
df_pca$species <- factor(df_pca$species)
pca_plot <- ggplot(df_pca,aes(PC1,PC2)) +geom_point(aes(col=protected,shape=species,alpha=vaccinated))+
scale_color_manual(values = c('#4878CF','#D65F5F'))+
scale_alpha_manual(values = c(0.5,1))+
ggtitle('') +
xlab(paste0('PC1'))+ ylab(paste0('PC2'))+theme_minimal()+
theme(text = element_text(size=16),plot.title = element_text(hjust = 0.5),
legend.text=element_text(size=16))
print(pca_plot)
### Reapeat for the average of all models-------------
#Load embeddings
z_human <- data.table::fread('results_intermediate_encoders/embs/z_human_1000ep.csv') %>% column_to_rownames('V1')
latent_dim <- ncol(z_human)
z_human <- z_human %>% mutate(protected = human_hiv$infect)
z_human <- z_human %>% mutate(vaccinated = human_hiv$trt)
z_human <- z_human %>% mutate(species = 'human')
z_human_base <- data.table::fread('results_intermediate_encoders/embs/z_human_base_1000ep.csv') %>% column_to_rownames('V1')
z_human_base <- z_human_base %>% mutate(protected = human_hiv$infect)
z_human_base <- z_human_base %>% mutate(vaccinated = human_hiv$trt)
z_human_base <- z_human_base %>% mutate(species = 'human')
z_primates <- data.table::fread('results_intermediate_encoders/embs/z_primates_1000ep.csv') %>% column_to_rownames('V1')
z_primates <- z_primates %>% mutate(protected = primates_nhp$ProtectBinary)
z_primates <- z_primates %>% mutate(vaccinated = primates_nhp$Vaccine)
z_primates <- z_primates %>% mutate(species = 'primates')
z_primates_base <- data.table::fread('results_intermediate_encoders/embs/z_primates_base_1000ep.csv') %>% column_to_rownames('V1')
z_primates_base <- z_primates_base %>% mutate(protected = primates_nhp$ProtectBinary)
z_primates_base <- z_primates_base %>% mutate(vaccinated = primates_nhp$Vaccine)
z_primates_base <- z_primates_base %>% mutate(species = 'primates')
z_latent <- rbind(z_human,z_primates)
z_latent_base <- rbind(z_human_base,z_primates_base)
### Dimensionality reduction and visualization
pca <- prcomp(z_latent_base[,1:latent_dim],center = T)
fviz_eig(pca, addlabels = TRUE,ncp = 15)
df_pca<- pca$x[,1:3]
df_pca <- as.data.frame(df_pca)
colnames(df_pca) <- c('PC1','PC2','PC3')
df_pca <- df_pca %>% mutate(protected = z_latent_base$protected)
df_pca$protected <- factor(df_pca$protected)
df_pca <- df_pca %>% mutate(vaccinated = z_latent_base$vaccinated)
df_pca$vaccinated <- factor(df_pca$vaccinated)
df_pca <- df_pca %>% mutate(species = z_latent_base$species)
df_pca$species <- factor(df_pca$species)
pca_plot <- ggplot(df_pca,aes(PC1,PC2)) +geom_point(aes(col=protected,shape=species,alpha=vaccinated))+
scale_color_manual(values = c('#4878CF','#D65F5F'))+
scale_alpha_manual(values = c(0.5,1))+
ggtitle('') +
xlab(paste0('PC1'))+ ylab(paste0('PC2'))+theme_minimal()+
theme(text = element_text(size=16),plot.title = element_text(hjust = 0.5),
legend.text=element_text(size=16))
print(pca_plot)
### Load embeddings and data and combine them
#Load data
human_expr <- data.table::fread('data/human_exprs.csv') %>% column_to_rownames('V1')
human_hiv <- data.table::fread('data/human_metadata.csv') %>% column_to_rownames('V1')
primates_expr <- data.table::fread('data/primates_exprs.csv') %>% column_to_rownames('V1')
primates_nhp <- data.table::fread('data/primates_metadata.csv') %>% column_to_rownames('V1')
plotList <- NULL
for (i in 1:10){
#Load embeddings
z_human <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_train_',i-1,'.csv')) %>% column_to_rownames('V1')
latent_dim <- ncol(z_human)
# z_human <- z_human %>% mutate(protected = human_hiv$infect)
# z_human <- z_human %>% mutate(vaccinated = human_hiv$trt)
z_human <- z_human %>% mutate(species = 'human')
z_human_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_human_base <- z_human_base %>% mutate(protected = human_hiv$infect)
# z_human_base <- z_human_base %>% mutate(vaccinated = human_hiv$trt)
z_human_base <- z_human_base %>% mutate(species = 'human')
z_primates <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates <- z_primates %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates <- z_primates %>% mutate(vaccinated = z_humanprimates_nhp$Vaccine)
z_primates <- z_primates %>% mutate(species = 'primates')
z_primates_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates_base <- z_primates_base %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates_base <- z_primates_base %>% mutate(vaccinated = primates_nhp$Vaccine)
z_primates_base <- z_primates_base %>% mutate(species = 'primates')
z_latent <- rbind(z_human,z_primates)
z_latent_base <- rbind(z_human_base,z_primates_base)
data.table::fwrite(z_latent_base,paste0('results_intermediate_encoders/embs/combined_10fold/latent_embeddings_global_',i,'.csv'))
data.table::fwrite(z_latent,paste0('results_intermediate_encoders/embs/combined_10fold/latent_embeddings_',i,'.csv'))
### Dimensionality reduction and visualization
pca <- prcomp(z_latent_base[,1:latent_dim],center = T)
#fviz_eig(pca, addlabels = TRUE,ncp = 15)
df_pca<- pca$x[,1:3]
df_pca <- as.data.frame(df_pca)
colnames(df_pca) <- c('PC1','PC2','PC3')
df_pca <- df_pca %>% mutate(protected = z_latent_base$protected)
df_pca$protected <- factor(df_pca$protected)
df_pca <- df_pca %>% mutate(vaccinated = z_latent_base$vaccinated)
df_pca$vaccinated <- factor(df_pca$vaccinated)
df_pca <- df_pca %>% mutate(species = z_latent_base$species)
df_pca$species <- factor(df_pca$species)
pca_plot <- ggplot(df_pca,aes(PC1,PC2)) +geom_point(aes(col=protected,shape=species,alpha=vaccinated))+
scale_color_manual(values = c('#4878CF','#D65F5F'))+
scale_alpha_manual(values = c(0.5,1))+
ggtitle('') +
xlab(paste0('PC1'))+ ylab(paste0('PC2'))+theme_minimal()+
theme(text = element_text(size=16),plot.title = element_text(hjust = 0.5),
legend.text=element_text(size=16))
#print(pca_plot)
plotList[[i]] <- pca_plot
z_latent_base_gathered <- z_latent_base %>% gather('latent_variable','value',-species,-vaccinated,-protected)
p_base <- ggplot(z_latent_base_gathered, aes(x = value, y = as.factor(latent_variable))) +
geom_density_ridges(stat = "binline",bins = 100,alpha = 0.8,
fill = '#125b80',color='black') +
ggtitle('Distribution of latent variables in global space')+
xlab('value') + ylab('latent variable')+ theme(base_family = "Arial") +
theme_pubr(base_family = "Arial",base_size = 14) +
theme(plot.title = element_text(hjust = 0.5))
print(p_base)
}
# Visualize all subplots
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
png(file="results_intermediate_encoders/pca_2d_global_train_2000ep.png",width=16,height=16,units = "in",res=600)
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
dev.off()
dev.off()
dev.off()
png(file="results_intermediate_encoders/pca_2d_global_train_2000ep.png",width=16,height=16,units = "in",res=600)
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
dev.off()
hist(z_latent_base_gathered$value)
hist(z_latent_base_gathered$value,100)
### Load embeddings and data and combine them
#Load data
human_expr <- data.table::fread('data/human_exprs.csv') %>% column_to_rownames('V1')
human_hiv <- data.table::fread('data/human_metadata.csv') %>% column_to_rownames('V1')
primates_expr <- data.table::fread('data/primates_exprs.csv') %>% column_to_rownames('V1')
primates_nhp <- data.table::fread('data/primates_metadata.csv') %>% column_to_rownames('V1')
plotList <- NULL
for (i in 1:10){
#Load embeddings
z_human <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_val_',i-1,'.csv')) %>% column_to_rownames('V1')
latent_dim <- ncol(z_human)
# z_human <- z_human %>% mutate(protected = human_hiv$infect)
# z_human <- z_human %>% mutate(vaccinated = human_hiv$trt)
z_human <- z_human %>% mutate(species = 'human')
z_human_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_base_val_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_human_base <- z_human_base %>% mutate(protected = human_hiv$infect)
# z_human_base <- z_human_base %>% mutate(vaccinated = human_hiv$trt)
z_human_base <- z_human_base %>% mutate(species = 'human')
z_primates <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_val_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates <- z_primates %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates <- z_primates %>% mutate(vaccinated = z_humanprimates_nhp$Vaccine)
z_primates <- z_primates %>% mutate(species = 'primates')
z_primates_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_base_val_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates_base <- z_primates_base %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates_base <- z_primates_base %>% mutate(vaccinated = primates_nhp$Vaccine)
z_primates_base <- z_primates_base %>% mutate(species = 'primates')
z_latent <- rbind(z_human,z_primates)
z_latent_base <- rbind(z_human_base,z_primates_base)
#data.table::fwrite(z_latent_base,paste0('results_intermediate_encoders/embs/combined_10fold/latent_embeddings_global_',i,'.csv'))
#data.table::fwrite(z_latent,paste0('results_intermediate_encoders/embs/combined_10fold/latent_embeddings_',i,'.csv'))
### Dimensionality reduction and visualization
pca <- prcomp(z_latent_base[,1:latent_dim],center = T)
#fviz_eig(pca, addlabels = TRUE,ncp = 15)
df_pca<- pca$x[,1:3]
df_pca <- as.data.frame(df_pca)
colnames(df_pca) <- c('PC1','PC2','PC3')
df_pca <- df_pca %>% mutate(protected = z_latent_base$protected)
df_pca$protected <- factor(df_pca$protected)
df_pca <- df_pca %>% mutate(vaccinated = z_latent_base$vaccinated)
df_pca$vaccinated <- factor(df_pca$vaccinated)
df_pca <- df_pca %>% mutate(species = z_latent_base$species)
df_pca$species <- factor(df_pca$species)
pca_plot <- ggplot(df_pca,aes(PC1,PC2)) +geom_point(aes(col=protected,shape=species,alpha=vaccinated))+
scale_color_manual(values = c('#4878CF','#D65F5F'))+
scale_alpha_manual(values = c(0.5,1))+
ggtitle('') +
xlab(paste0('PC1'))+ ylab(paste0('PC2'))+theme_minimal()+
theme(text = element_text(size=16),plot.title = element_text(hjust = 0.5),
legend.text=element_text(size=16))
#print(pca_plot)
plotList[[i]] <- pca_plot
z_latent_base_gathered <- z_latent_base %>% gather('latent_variable','value',-species,-vaccinated,-protected)
p_base <- ggplot(z_latent_base_gathered, aes(x = value, y = as.factor(latent_variable))) +
geom_density_ridges(stat = "binline",bins = 100,alpha = 0.8,
fill = '#125b80',color='black') +
ggtitle('Distribution of latent variables in global space')+
xlab('value') + ylab('latent variable')+ theme(base_family = "Arial") +
theme_pubr(base_family = "Arial",base_size = 14) +
theme(plot.title = element_text(hjust = 0.5))
print(p_base)
}
# Visualize all subplots
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
png(file="results_intermediate_encoders/pca_2d_global_val_2000ep.png",width=16,height=16,units = "in",res=600)
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
dev.off()
View(z_latent_base_gathered)
View(z_latent_base)
