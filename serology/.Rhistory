df_pca <- df_pca %>% mutate(species = z_latent_base$species)
df_pca$species <- factor(df_pca$species)
pca_plot <- ggplot(df_pca,aes(PC1,PC2)) +geom_point(aes(col=protected,shape=species,alpha=vaccinated))+
scale_color_manual(values = c('#4878CF','#D65F5F'))+
scale_alpha_manual(values = c(0.5,1))+
ggtitle('') +
xlab(paste0('PC1'))+ ylab(paste0('PC2'))+theme_minimal()+
theme(text = element_text(size=16),plot.title = element_text(hjust = 0.5),
legend.text=element_text(size=16))
#print(pca_plot)
plotList[[i]] <- pca_plot
}
# Visualize all subplots
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
png(file="results_intermediate_encoders/pca_2d_global_train.png",width=16,height=16,units = "in",res=600)
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
dev.off()
### Load embeddings and data and combine them
#Load data
human_expr <- data.table::fread('data/human_exprs.csv') %>% column_to_rownames('V1')
human_hiv <- data.table::fread('data/human_metadata.csv') %>% column_to_rownames('V1')
primates_expr <- data.table::fread('data/primates_exprs.csv') %>% column_to_rownames('V1')
primates_nhp <- data.table::fread('data/primates_metadata.csv') %>% column_to_rownames('V1')
plotList <- NULL
for (i in 1:10){
#Load embeddings
z_human <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_val_',i-1,'.csv')) %>% column_to_rownames('V1')
latent_dim <- ncol(z_human)
# z_human <- z_human %>% mutate(protected = human_hiv$infect)
# z_human <- z_human %>% mutate(vaccinated = human_hiv$trt)
z_human <- z_human %>% mutate(species = 'human')
z_human_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_base_val_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_human_base <- z_human_base %>% mutate(protected = human_hiv$infect)
# z_human_base <- z_human_base %>% mutate(vaccinated = human_hiv$trt)
z_human_base <- z_human_base %>% mutate(species = 'human')
z_primates <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_val_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates <- z_primates %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates <- z_primates %>% mutate(vaccinated = z_humanprimates_nhp$Vaccine)
z_primates <- z_primates %>% mutate(species = 'primates')
z_primates_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_base_val_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates_base <- z_primates_base %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates_base <- z_primates_base %>% mutate(vaccinated = primates_nhp$Vaccine)
z_primates_base <- z_primates_base %>% mutate(species = 'primates')
z_latent <- rbind(z_human,z_primates)
z_latent_base <- rbind(z_human_base,z_primates_base)
### Dimensionality reduction and visualization
pca <- prcomp(z_latent_base[,1:latent_dim])
#fviz_eig(pca, addlabels = TRUE,ncp = 15)
df_pca<- pca$x[,1:3]
df_pca <- as.data.frame(df_pca)
colnames(df_pca) <- c('PC1','PC2','PC3')
df_pca <- df_pca %>% mutate(protected = z_latent_base$protected)
df_pca$protected <- factor(df_pca$protected)
df_pca <- df_pca %>% mutate(vaccinated = z_latent_base$vaccinated)
df_pca$vaccinated <- factor(df_pca$vaccinated)
df_pca <- df_pca %>% mutate(species = z_latent_base$species)
df_pca$species <- factor(df_pca$species)
pca_plot <- ggplot(df_pca,aes(PC1,PC2)) +geom_point(aes(col=protected,shape=species,alpha=vaccinated))+
scale_color_manual(values = c('#4878CF','#D65F5F'))+
scale_alpha_manual(values = c(0.5,1))+
ggtitle('') +
xlab(paste0('PC1'))+ ylab(paste0('PC2'))+theme_minimal()+
theme(text = element_text(size=16),plot.title = element_text(hjust = 0.5),
legend.text=element_text(size=16))
#print(pca_plot)
plotList[[i]] <- pca_plot
}
# Visualize all subplots
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
png(file="results_intermediate_encoders/pca_2d_global_val.png",width=16,height=16,units = "in",res=600)
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
dev.off()
library(tidyverse)
library(readxl)
library(ggplot2)
library(ggsignif)
library(ggpubr)
library(factoextra)
library(Rtsne)
library(plotly)
### Load embeddings and data and combine them
#Load data
human_expr <- data.table::fread('data/human_exprs.csv') %>% column_to_rownames('V1')
human_hiv <- data.table::fread('data/human_metadata.csv') %>% column_to_rownames('V1')
primates_expr <- data.table::fread('data/primates_exprs.csv') %>% column_to_rownames('V1')
primates_nhp <- data.table::fread('data/primates_metadata.csv') %>% column_to_rownames('V1')
plotList <- NULL
for (i in 1:10){
#Load embeddings
z_human <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_val_',i-1,'.csv')) %>% column_to_rownames('V1')
latent_dim <- ncol(z_human)
# z_human <- z_human %>% mutate(protected = human_hiv$infect)
# z_human <- z_human %>% mutate(vaccinated = human_hiv$trt)
z_human <- z_human %>% mutate(species = 'human')
z_human_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_base_val_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_human_base <- z_human_base %>% mutate(protected = human_hiv$infect)
# z_human_base <- z_human_base %>% mutate(vaccinated = human_hiv$trt)
z_human_base <- z_human_base %>% mutate(species = 'human')
z_primates <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_val_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates <- z_primates %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates <- z_primates %>% mutate(vaccinated = z_humanprimates_nhp$Vaccine)
z_primates <- z_primates %>% mutate(species = 'primates')
z_primates_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_base_val_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates_base <- z_primates_base %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates_base <- z_primates_base %>% mutate(vaccinated = primates_nhp$Vaccine)
z_primates_base <- z_primates_base %>% mutate(species = 'primates')
z_latent <- rbind(z_human,z_primates)
z_latent_base <- rbind(z_human_base,z_primates_base)
### Dimensionality reduction and visualization
pca <- prcomp(z_latent_base[,1:latent_dim])
#fviz_eig(pca, addlabels = TRUE,ncp = 15)
df_pca<- pca$x[,1:3]
df_pca <- as.data.frame(df_pca)
colnames(df_pca) <- c('PC1','PC2','PC3')
df_pca <- df_pca %>% mutate(protected = z_latent_base$protected)
df_pca$protected <- factor(df_pca$protected)
df_pca <- df_pca %>% mutate(vaccinated = z_latent_base$vaccinated)
df_pca$vaccinated <- factor(df_pca$vaccinated)
df_pca <- df_pca %>% mutate(species = z_latent_base$species)
df_pca$species <- factor(df_pca$species)
pca_plot <- ggplot(df_pca,aes(PC1,PC2)) +geom_point(aes(col=protected,shape=species,alpha=vaccinated))+
scale_color_manual(values = c('#4878CF','#D65F5F'))+
scale_alpha_manual(values = c(0.5,1))+
ggtitle('') +
xlab(paste0('PC1'))+ ylab(paste0('PC2'))+theme_minimal()+
theme(text = element_text(size=16),plot.title = element_text(hjust = 0.5),
legend.text=element_text(size=16))
#print(pca_plot)
plotList[[i]] <- pca_plot
}
# Visualize all subplots
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
png(file="results_intermediate_encoders/pca_2d_global_val_1000ep.png",width=16,height=16,units = "in",res=600)
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
dev.off()
### Load embeddings and data and combine them
#Load data
human_expr <- data.table::fread('data/human_exprs.csv') %>% column_to_rownames('V1')
human_hiv <- data.table::fread('data/human_metadata.csv') %>% column_to_rownames('V1')
primates_expr <- data.table::fread('data/primates_exprs.csv') %>% column_to_rownames('V1')
primates_nhp <- data.table::fread('data/primates_metadata.csv') %>% column_to_rownames('V1')
plotList <- NULL
for (i in 1:10){
#Load embeddings
z_human <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_train_',i-1,'.csv')) %>% column_to_rownames('V1')
latent_dim <- ncol(z_human)
# z_human <- z_human %>% mutate(protected = human_hiv$infect)
# z_human <- z_human %>% mutate(vaccinated = human_hiv$trt)
z_human <- z_human %>% mutate(species = 'human')
z_human_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_human_base <- z_human_base %>% mutate(protected = human_hiv$infect)
# z_human_base <- z_human_base %>% mutate(vaccinated = human_hiv$trt)
z_human_base <- z_human_base %>% mutate(species = 'human')
z_primates <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates <- z_primates %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates <- z_primates %>% mutate(vaccinated = z_humanprimates_nhp$Vaccine)
z_primates <- z_primates %>% mutate(species = 'primates')
z_primates_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates_base <- z_primates_base %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates_base <- z_primates_base %>% mutate(vaccinated = primates_nhp$Vaccine)
z_primates_base <- z_primates_base %>% mutate(species = 'primates')
z_latent <- rbind(z_human,z_primates)
z_latent_base <- rbind(z_human_base,z_primates_base)
### Dimensionality reduction and visualization
pca <- prcomp(z_latent_base[,1:latent_dim])
#fviz_eig(pca, addlabels = TRUE,ncp = 15)
df_pca<- pca$x[,1:3]
df_pca <- as.data.frame(df_pca)
colnames(df_pca) <- c('PC1','PC2','PC3')
df_pca <- df_pca %>% mutate(protected = z_latent_base$protected)
df_pca$protected <- factor(df_pca$protected)
df_pca <- df_pca %>% mutate(vaccinated = z_latent_base$vaccinated)
df_pca$vaccinated <- factor(df_pca$vaccinated)
df_pca <- df_pca %>% mutate(species = z_latent_base$species)
df_pca$species <- factor(df_pca$species)
pca_plot <- ggplot(df_pca,aes(PC1,PC2)) +geom_point(aes(col=protected,shape=species,alpha=vaccinated))+
scale_color_manual(values = c('#4878CF','#D65F5F'))+
scale_alpha_manual(values = c(0.5,1))+
ggtitle('') +
xlab(paste0('PC1'))+ ylab(paste0('PC2'))+theme_minimal()+
theme(text = element_text(size=16),plot.title = element_text(hjust = 0.5),
legend.text=element_text(size=16))
#print(pca_plot)
plotList[[i]] <- pca_plot
}
# Visualize all subplots
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
png(file="results_intermediate_encoders/pca_2d_global_train_1000ep.png",width=16,height=16,units = "in",res=600)
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
dev.off()
library(tidyverse)
library(readxl)
library(ggplot2)
library(ggsignif)
library(ggpubr)
library(factoextra)
library(Rtsne)
library(plotly)
### Load embeddings and data and combine them
#Load data
human_expr <- data.table::fread('data/human_exprs.csv') %>% column_to_rownames('V1')
human_hiv <- data.table::fread('data/human_metadata.csv') %>% column_to_rownames('V1')
primates_expr <- data.table::fread('data/primates_exprs.csv') %>% column_to_rownames('V1')
primates_nhp <- data.table::fread('data/primates_metadata.csv') %>% column_to_rownames('V1')
plotList <- NULL
for (i in 1:10){
#Load embeddings
z_human <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_train_',i-1,'.csv')) %>% column_to_rownames('V1')
latent_dim <- ncol(z_human)
# z_human <- z_human %>% mutate(protected = human_hiv$infect)
# z_human <- z_human %>% mutate(vaccinated = human_hiv$trt)
z_human <- z_human %>% mutate(species = 'human')
z_human_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_human_base <- z_human_base %>% mutate(protected = human_hiv$infect)
# z_human_base <- z_human_base %>% mutate(vaccinated = human_hiv$trt)
z_human_base <- z_human_base %>% mutate(species = 'human')
z_primates <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates <- z_primates %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates <- z_primates %>% mutate(vaccinated = z_humanprimates_nhp$Vaccine)
z_primates <- z_primates %>% mutate(species = 'primates')
z_primates_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates_base <- z_primates_base %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates_base <- z_primates_base %>% mutate(vaccinated = primates_nhp$Vaccine)
z_primates_base <- z_primates_base %>% mutate(species = 'primates')
z_latent <- rbind(z_human,z_primates)
z_latent_base <- rbind(z_human_base,z_primates_base)
### Dimensionality reduction and visualization
pca <- prcomp(z_latent_base[,1:latent_dim])
#fviz_eig(pca, addlabels = TRUE,ncp = 15)
df_pca<- pca$x[,1:3]
df_pca <- as.data.frame(df_pca)
colnames(df_pca) <- c('PC1','PC2','PC3')
df_pca <- df_pca %>% mutate(protected = z_latent_base$protected)
df_pca$protected <- factor(df_pca$protected)
df_pca <- df_pca %>% mutate(vaccinated = z_latent_base$vaccinated)
df_pca$vaccinated <- factor(df_pca$vaccinated)
df_pca <- df_pca %>% mutate(species = z_latent_base$species)
df_pca$species <- factor(df_pca$species)
pca_plot <- ggplot(df_pca,aes(PC1,PC2)) +geom_point(aes(col=protected,shape=species,alpha=vaccinated))+
scale_color_manual(values = c('#4878CF','#D65F5F'))+
scale_alpha_manual(values = c(0.5,1))+
ggtitle('') +
xlab(paste0('PC1'))+ ylab(paste0('PC2'))+theme_minimal()+
theme(text = element_text(size=16),plot.title = element_text(hjust = 0.5),
legend.text=element_text(size=16))
#print(pca_plot)
plotList[[i]] <- pca_plot
}
# Visualize all subplots
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
png(file="results_intermediate_encoders/pca_2d_global_train_1000ep.png",width=16,height=16,units = "in",res=600)
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
dev.off()
png(file="results_intermediate_encoders/pca_2d_global_train2.png",width=16,height=16,units = "in",res=600)
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
dev.off()
library(tidyverse)
library(readxl)
library(ggplot2)
library(ggsignif)
library(ggpubr)
library(factoextra)
library(Rtsne)
library(plotly)
### Load embeddings and data and combine them
#Load data
human_expr <- data.table::fread('data/human_exprs.csv') %>% column_to_rownames('V1')
human_hiv <- data.table::fread('data/human_metadata.csv') %>% column_to_rownames('V1')
primates_expr <- data.table::fread('data/primates_exprs.csv') %>% column_to_rownames('V1')
primates_nhp <- data.table::fread('data/primates_metadata.csv') %>% column_to_rownames('V1')
plotList <- NULL
for (i in 1:10){
#Load embeddings
z_human <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_train_',i-1,'.csv')) %>% column_to_rownames('V1')
latent_dim <- ncol(z_human)
# z_human <- z_human %>% mutate(protected = human_hiv$infect)
# z_human <- z_human %>% mutate(vaccinated = human_hiv$trt)
z_human <- z_human %>% mutate(species = 'human')
z_human_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_human_base <- z_human_base %>% mutate(protected = human_hiv$infect)
# z_human_base <- z_human_base %>% mutate(vaccinated = human_hiv$trt)
z_human_base <- z_human_base %>% mutate(species = 'human')
z_primates <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates <- z_primates %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates <- z_primates %>% mutate(vaccinated = z_humanprimates_nhp$Vaccine)
z_primates <- z_primates %>% mutate(species = 'primates')
z_primates_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates_base <- z_primates_base %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates_base <- z_primates_base %>% mutate(vaccinated = primates_nhp$Vaccine)
z_primates_base <- z_primates_base %>% mutate(species = 'primates')
z_latent <- rbind(z_human,z_primates)
z_latent_base <- rbind(z_human_base,z_primates_base)
### Dimensionality reduction and visualization
pca <- prcomp(z_latent_base[,1:latent_dim])
#fviz_eig(pca, addlabels = TRUE,ncp = 15)
df_pca<- pca$x[,1:3]
df_pca <- as.data.frame(df_pca)
colnames(df_pca) <- c('PC1','PC2','PC3')
df_pca <- df_pca %>% mutate(protected = z_latent_base$protected)
df_pca$protected <- factor(df_pca$protected)
df_pca <- df_pca %>% mutate(vaccinated = z_latent_base$vaccinated)
df_pca$vaccinated <- factor(df_pca$vaccinated)
df_pca <- df_pca %>% mutate(species = z_latent_base$species)
df_pca$species <- factor(df_pca$species)
pca_plot <- ggplot(df_pca,aes(PC1,PC2)) +geom_point(aes(col=protected,shape=species,alpha=vaccinated))+
scale_color_manual(values = c('#4878CF','#D65F5F'))+
scale_alpha_manual(values = c(0.5,1))+
ggtitle('') +
xlab(paste0('PC1'))+ ylab(paste0('PC2'))+theme_minimal()+
theme(text = element_text(size=16),plot.title = element_text(hjust = 0.5),
legend.text=element_text(size=16))
#print(pca_plot)
plotList[[i]] <- pca_plot
}
# Visualize all subplots
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
gc()
library(tidyverse)
library(readxl)
library(ggplot2)
library(ggsignif)
library(ggpubr)
library(factoextra)
library(Rtsne)
library(plotly)
### Load embeddings and data and combine them
#Load data
human_expr <- data.table::fread('data/human_exprs.csv') %>% column_to_rownames('V1')
human_hiv <- data.table::fread('data/human_metadata.csv') %>% column_to_rownames('V1')
primates_expr <- data.table::fread('data/primates_exprs.csv') %>% column_to_rownames('V1')
primates_nhp <- data.table::fread('data/primates_metadata.csv') %>% column_to_rownames('V1')
plotList <- NULL
for (i in 1:10){
#Load embeddings
z_human <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_train_',i-1,'.csv')) %>% column_to_rownames('V1')
latent_dim <- ncol(z_human)
# z_human <- z_human %>% mutate(protected = human_hiv$infect)
# z_human <- z_human %>% mutate(vaccinated = human_hiv$trt)
z_human <- z_human %>% mutate(species = 'human')
z_human_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_human_base <- z_human_base %>% mutate(protected = human_hiv$infect)
# z_human_base <- z_human_base %>% mutate(vaccinated = human_hiv$trt)
z_human_base <- z_human_base %>% mutate(species = 'human')
z_primates <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates <- z_primates %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates <- z_primates %>% mutate(vaccinated = z_humanprimates_nhp$Vaccine)
z_primates <- z_primates %>% mutate(species = 'primates')
z_primates_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates_base <- z_primates_base %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates_base <- z_primates_base %>% mutate(vaccinated = primates_nhp$Vaccine)
z_primates_base <- z_primates_base %>% mutate(species = 'primates')
z_latent <- rbind(z_human,z_primates)
z_latent_base <- rbind(z_human_base,z_primates_base)
### Dimensionality reduction and visualization
pca <- prcomp(z_latent_base[,1:latent_dim])
#fviz_eig(pca, addlabels = TRUE,ncp = 15)
df_pca<- pca$x[,1:3]
df_pca <- as.data.frame(df_pca)
colnames(df_pca) <- c('PC1','PC2','PC3')
df_pca <- df_pca %>% mutate(protected = z_latent_base$protected)
df_pca$protected <- factor(df_pca$protected)
df_pca <- df_pca %>% mutate(vaccinated = z_latent_base$vaccinated)
df_pca$vaccinated <- factor(df_pca$vaccinated)
df_pca <- df_pca %>% mutate(species = z_latent_base$species)
df_pca$species <- factor(df_pca$species)
pca_plot <- ggplot(df_pca,aes(PC1,PC2)) +geom_point(aes(col=protected,shape=species,alpha=vaccinated))+
scale_color_manual(values = c('#4878CF','#D65F5F'))+
scale_alpha_manual(values = c(0.5,1))+
ggtitle('') +
xlab(paste0('PC1'))+ ylab(paste0('PC2'))+theme_minimal()+
theme(text = element_text(size=16),plot.title = element_text(hjust = 0.5),
legend.text=element_text(size=16))
#print(pca_plot)
plotList[[i]] <- pca_plot
}
# Visualize all subplots
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
png(file="results_intermediate_encoders/pca_2d_global_train2.png",width=16,height=16,units = "in",res=600)
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
dev.off()
plot_ly(df_pca) %>% add_trace(x = ~PC1, y = ~PC2, z = ~PC3,color = ~protected,
type = "scatter3d",
mode = "markers",
colors = c('#4878CF','#D65F5F'),
showlegend = TRUE,
size = 2
)
### Load embeddings and data and combine them
#Load data
human_expr <- data.table::fread('data/human_exprs.csv') %>% column_to_rownames('V1')
human_hiv <- data.table::fread('data/human_metadata.csv') %>% column_to_rownames('V1')
primates_expr <- data.table::fread('data/primates_exprs.csv') %>% column_to_rownames('V1')
primates_nhp <- data.table::fread('data/primates_metadata.csv') %>% column_to_rownames('V1')
plotList <- NULL
for (i in 1:10){
#Load embeddings
z_human <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_train_',i-1,'.csv')) %>% column_to_rownames('V1')
latent_dim <- ncol(z_human)
# z_human <- z_human %>% mutate(protected = human_hiv$infect)
# z_human <- z_human %>% mutate(vaccinated = human_hiv$trt)
z_human <- z_human %>% mutate(species = 'human')
z_human_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_human_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_human_base <- z_human_base %>% mutate(protected = human_hiv$infect)
# z_human_base <- z_human_base %>% mutate(vaccinated = human_hiv$trt)
z_human_base <- z_human_base %>% mutate(species = 'human')
z_primates <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates <- z_primates %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates <- z_primates %>% mutate(vaccinated = z_humanprimates_nhp$Vaccine)
z_primates <- z_primates %>% mutate(species = 'primates')
z_primates_base <- data.table::fread(paste0('results_intermediate_encoders/embs/10fold/z_primates_base_train_',i-1,'.csv')) %>% column_to_rownames('V1')
# z_primates_base <- z_primates_base %>% mutate(protected = primates_nhp$ProtectBinary)
# z_primates_base <- z_primates_base %>% mutate(vaccinated = primates_nhp$Vaccine)
z_primates_base <- z_primates_base %>% mutate(species = 'primates')
z_latent <- rbind(z_human,z_primates)
z_latent_base <- rbind(z_human_base,z_primates_base)
### Dimensionality reduction and visualization
pca <- prcomp(z_latent_base[,1:latent_dim])
#fviz_eig(pca, addlabels = TRUE,ncp = 15)
df_pca<- pca$x[,1:3]
df_pca <- as.data.frame(df_pca)
colnames(df_pca) <- c('PC1','PC2','PC3')
df_pca <- df_pca %>% mutate(protected = z_latent_base$protected)
df_pca$protected <- factor(df_pca$protected)
df_pca <- df_pca %>% mutate(vaccinated = z_latent_base$vaccinated)
df_pca$vaccinated <- factor(df_pca$vaccinated)
df_pca <- df_pca %>% mutate(species = z_latent_base$species)
df_pca$species <- factor(df_pca$species)
pca_plot <- ggplot(df_pca,aes(PC1,PC2)) +geom_point(aes(col=protected,shape=species,alpha=vaccinated))+
scale_color_manual(values = c('#4878CF','#D65F5F'))+
scale_alpha_manual(values = c(0.5,1))+
ggtitle('') +
xlab(paste0('PC1'))+ ylab(paste0('PC2'))+theme_minimal()+
theme(text = element_text(size=16),plot.title = element_text(hjust = 0.5),
legend.text=element_text(size=16))
#print(pca_plot)
plotList[[i]] <- pca_plot
}
# Visualize all subplots
p <- ggarrange(plotlist=plotList,ncol=2,nrow=5,common.legend = TRUE,legend = 'bottom',
labels = paste0(rep('Split ',2),seq(1,10)),
font.label = list(size = 10, color = "black", face = "plain", family = 'Arial'),
hjust=-0.15)
annotate_figure(p, top = text_grob("PCA visualization of the global latent space",
color = "black",face = 'plain',family = 'Arial', size = 14))
